<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="service_data.js" type="text/javascript"></script>
    <title>"Don't Drink and Drive</title>
    <link rel="stylesheet" href="services_style.css">
    
</head>
<script>
 //lab12 check to see if q is a non-negative integer
   /* function isNonNegInt(q, sendArrayBack = false) {
        errors = []; // assume no errors at first
        if (q == '') q = 0; //if q is blank, set it to 0
        if (Number(q) != q) errors.push('Not a number!'); // Check if string is a number value
        else if (q < 0) errors.push('Negative value!'); // Check if q is non-negative
        else if (parseInt(q) != q) errors.push('Not an integer!'); // Check that q is an integer
        return sendArrayBack ? errors : (errors.length == 0);
    }
    function checkQuantityTextbox() {   //lab 11
            errs = isNonNegInt(qtyTextbox.value, true); //errs is set to qtyTextbox
            qtyTextbox_message.innerHTML = errs.join(',');
            /*errs = isNonNegInt(qtyTextbox.value, true);
            if (errs.length == 0) errs = ['Quantity:'];
            if (textbox.value.trim() == '') errs = ['Quantity'];
            document.getElementById(textbox.name + '_label').innerHTML = errs.join(", ");
    } 
*/

   
    let params = (new URL(document.location)).searchParams; //params = search parameters from a NEW URL 
    
    window.onload = function () { 
        if (params.has('validQuantities')) { //alert if there is a valid quantity
            if (params.get("validQuantities") == false) { //invalid quantites triggers an alert
                alert('Invalid quantity selected, please try again');

            }
            if (params.get('validPurchases') == false) { //if no services were selected
                alert("Please select a service"); //alert user no services were selected
            }

            for (i = 0; i < services.length; i++) { // for every product
                if (params.has(`qtyTextbox${i}`)) { // if there is something in the textbox
                    a_qty = params.get(`qtyTextbox${i}`); // assign textbox data to a_qty
                    // make textboxes sticky in case of invalid data
                    passenger_request_form[`qtyTextbox${i}`].value = a_qty; // have the value from the textbox in the form for given product equal to a_qty
                    if (!isNonNegInt(a_qty)) { // if a_qty is not a positive integer
                        checkQuantityTextbox(passenger_request_form[`qtyTextbox${i}`]); // locate errors
                    }
                }
            }
        }
    }
    //Checking quantity in the textbox (from Assignment1_Design_Examples 1_2 display)
    function checkQuantityTextbox(a_qty) {
        errs = isNonNegInt(a_qty.value, true); // err = value of whatever in textbox as long as integer
            if (errs.length == 0) errs = ['You want:'];
            if (a_qty.value.trim() == '') errs = ['Quantity'];
            document.getElementById(a_qty.name + '_label').innerHTML = errs.join(", ");
    }     
        //lab12 check to see if a_qty is a non-negative integer
    function isNonNegInt(a_qty, sendArrayBack = false) {
        errors = []; // assume no errors at first
        if (a_qty == '') a_qty = 0; //if a_qty is blank, set it to 0
        if (Number(a_qty) != a_qty) errors.push('Not a number!'); // Check if string is a number value
        else if (a_qty < 0) errors.push('Negative value!'); // Check if a_qty is non-negative
        else if (parseInt(a_qty) != a_qty) errors.push('Not an integer!'); // Check that a_qty is an integer
        return sendArrayBack ? errors : (errors.length == 0);
    }    

    function thankYou() {
    if (isNonNegInt(passenger_request_form.qtyTextbox.value)) {
        document.write(`Thank you, ${username}, your driver is on the way`);
    } else {
        alert('Please enter a valid quantity')
    }
    }

    /*window.onload = function () { 
            if (params.has('validQuanitities')) { //if there is a valid quantity
            validPurchases = true;  //no errors, positive integers were entered
            validQuantities = 0; 
            for (i = 0; i < services.length; i++) //list all services
            {
            if (params.has(`qtyTextbox${i}`)) //have
                {
                a_qty = params.get(`qtyTextbox${i}`);
                passenger_request_form[`qtyTextbox${i}`].value = a_qty; //data validation textbox
                validPurchases += a_qty; //cycle through textboxes
                    if (!isNonNegInt(a_qty)) 
                    {
                    ValidPurchases = true;
                    checkQuantityTextbox(passenger_request_form[`qtyTextbox${i}`]);
                    }
                }
            }
        
            if (validPurchases) { //determination on if inputs are ready for checkout
                alert("Enter Total Number of Passengers for Each Service");
            } else if (validQuantites == 0) {
                alert("How Far Are We Going? How Many Passengers?");
            } else { 
                window.location = `./checkout.html${document.location.search}`; //redirect to /purchase 
                window.stop;
        }
    }
} */
</script>
<body>
    <header>
        <h1>Drunk Ride Store</h1>
    </header>
    <ul>
    <div style="text-align: right;"><li><a href="./index.html">Home</a></li>
    <a class="active" href="./order_page.html"></a>
    </ul>
        <form name="passenger_request_form" action="Purchase" method="GET"> 
         
        <div style="text-align: center;">
        <br>  
            <main>
            <script> //Instead of placeholder, there is a value to ensure the miles are at least 5, leading to a $10 charge
                for (i = 0; i < services.length; i++) {
                    document.write(`
            <section class="item">
                <h2>${services[i].service}</h2>
                <h3>$${services[i].price}</h3>
                <img src = "./images/${services[i].image}">
                <h4>${services[i].description}</h4>
                <h5>${services[i].description2}</h4> 
                        
                    <br>
                <label id="qtyTextbox${i}"}">Total Passengers:</label>
                <input type = "text" 
                        value=${services[i].default} 
                        name="qtyTextbox${i}" 
                        onkeyup="checkQuantityTextbox(this);">
            </section>
            `);}    
            </script>
            </main>
                <br>
            <input type = "submit"   
                   class = "button"
                   value = "Purchase!">
            </div>
        </form>
    </body>
    <ul>
            <div style="text-align: right;"><li><a href="./index.html">Home</a></li>
        <a class="active" href="./order_page.html"></a>
    </ul>
     
</body>
